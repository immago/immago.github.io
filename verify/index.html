<!--
This page is autogenerated by Eleventy (11ty). Do not ty to find any style or meaning here.
-->
<!doctype html>
<html lang="ru">
	<head>
		<meta charset="utf-8">
		<title>Verify</title>
		<link rel="preload" as="style" href="/css/roboto-condensed.css">
		<link href="/css/roboto-condensed.css" rel="stylesheet">
		<script src="/js/lib/jquery-3.7.1/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="/fontawesome/css/all.min.css">
		<link rel="stylesheet" href="/css/common.css">
		<link rel="stylesheet" href="/css/menu.css">
		<link rel="stylesheet" href="/css/footer.css">

		<link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
		<link rel="manifest" href="/static/favicon/site.webmanifest">

		
	<link rel="stylesheet" href="/css/lib/fancyappsui-5.0/fancybox.css"/>
	<link rel="stylesheet" href="/css/serial-validator.css">
	<script src="/js/lib/imagesloaded-5/imagesloaded.pkgd.min.js"></script>
	<script src="/js/lib/masonry-layout-4.2.2/masonry.pkgd.min.js"></script>
	<script src="/js/lib/fancyappsui-5.0/fancybox.umd.js"></script>

	</head>
	<body>
		
<div class="topnav" id="top-naviagation">
	<a href="/" class="logo">POLEWKA LABS</a>
	<span  class="topnav-buttons">
	<a href="/">3D Prints</a>
	<a href="/contacts">Contact</a>
	</span >
		
	<a href="javascript:void(0);" class="icon" onclick="myFunction()">
		<i class="fa fa-bars"></i>
	</a>
</div>

<script>
	/* Toggle between adding and removing the "responsive" class to topnav when the user clicks on the icon */
	function myFunction() {
	  var x = document.getElementById("top-naviagation");
	  if (x.className === "topnav") {
		x.className += " responsive";
	  } else {
		x.className = "topnav";
	  }
	}
</script>
		

	<div class="content">
		<div class="title-container">
			<h1>Проверка продукта</h1>
			<div class="serial">По серйному номеру, например: PLWK-TEST-25.01/01</div>
			<div class="description">Введите серийный номер номер продукта</div>
		</div>

		<div id="serial-validator">
			<input type="text" id="serialInput" placeholder="PLWK-PRODUCT-25.01/01" />

			<div id="validation-result" class="validation-message" style="display:none;">
				<div id="validation-result-message">
					...
				</div>
				<a id="success-link" href="#" class="serial-link">Подробнее ➜</a>
			</div>
			

		</div>
	</div>

	<script>

		
		
		
			
			
			
			
			
		
		

		const serialData = [{"id":"test-project","productName":"project title","prefix":"PLWK-TEST","batches":[{"id":"25.01","count":10}]}];

		function validateSerial(serial) {
			const normalized = serial.toUpperCase().trim();

			// Loop through all available serial definitions
			for (const data of serialData) {
					const prefix = data.prefix.toUpperCase();
					const regex = new RegExp(`^${prefix}-(\\d{2}\\.\\d{2})\\/(\\d+)$`);

					const match = normalized.match(regex);
					if (!match) continue; // Try next serial definition

					const batchId = match[1];
					const number = parseInt(match[2], 10);

					const batch = data.batches.find(b => b.id === batchId);
					if (!batch) {
						return {
							valid: false,
							message: `❌ Неверный ID пратии (${batchId})`
						};
					}

					if (number < 1 || number > batch.count) {
						return {
							valid: false,
							message: `❌ Неверный порядковый номер продукта (${number})`
						};
					}

					// ✅ Valid match
					console.log(data)
					return {
						valid: true,
						message: `✅ Это продукт POLEWKA Labs: ${data.productName}`,
						link: `/print-details/${data.id}`,
						productName: data.productName
					};
				}

				// ❌ No matching prefix found
				return {
					valid: false,
					message: "❌ Серийный номер не найден"
				};
			}

		document.addEventListener("DOMContentLoaded", () => {
			const input = document.getElementById('serialInput');
			const validationResultEl = document.getElementById('validation-result');
			const validationResultMessageEl = document.getElementById('validation-result-message');
			const successLink = document.getElementById('success-link');

			input.addEventListener('input', () => {
				const result = validateSerial(input.value);

				validationResultEl.style.display = 'block';
				validationResultMessageEl.innerHTML = result.message;

				if (result.valid) {
					successLink.href = result.link;
					successLink.style.display = 'inline-block';
				} else {
					successLink.style.display = 'none';
				}
			});
		});


	</script>

		<div class="footer">
	Contact me
	<div class="social">
		<a href="https://t.me/immago" target="_blank" class="link"><i class="fa-brands fa-fw fa-telegram"></i></a>
		<a href="https://github.com/immago" target="_blank" class="link"><i class="fa-brands fa-fw fa-github"></i></a>
	</div>
	
	<div class="copyright">
		© 2025 Developed by Dmitry Byankin
	</div>
</div>

	</body>
</html>